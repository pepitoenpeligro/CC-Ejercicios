# Ejercicio 1. Buscar alguna demo interesante de Docker y ejecutarla localmente, o en su defecto, ejecutar la imagen anterior y ver cómo funciona y los procesos que se llevan a cabo la primera vez que se ejecuta y las siguientes ocasiones. 

Necesitamos primero instalar `Docker`. Para instalar `Docker` en `OS X` vamos a usar el gestor de paquetes `brew` tal y como hemos venido haciendo en los ejercicios del tema 1 y tema 2.


```shell
brew install docker docker-machine
brew cask install virtualbox
```

![Docker Version](https://github.com/pepitoenpeligro/CC-Ejercicios/blob/master/images/3/01-docker-version.png)

Vamos a configurar `docker-machine`, que es una herramienta que nos permite crear, gestionar y configurar máquinas virtuales o físicas con `Docker Engine`. Nos será útil más adelante. Para ello le indicamos que el _driver_ principal es `virtualbox`:


```shell
docker-machine create --driver virtualbox default
docker-machine ls
docker-machine env default
```

![Docker Machine Setup](https://github.com/pepitoenpeligro/CC-Ejercicios/blob/master/images/3/01-docker-version.png)

:warning: Podemos reiniciar la máquina docker con `docker-machine restart`


![Docker Hello World](https://github.com/pepitoenpeligro/CC-Ejercicios/blob/master/images/3/01-docker-hello-world.png)

Encontramos una imagen docker interesante en `jjmerelo/dalesky` que podemos encontrar en [Docker Hub](https://hub.docker.com/r/jjmerelo/docker-daleksay)

```shell
docker pull jjmerelo/docker-daleksay
docker run -rm jjmerelo/docker-daleksay
```

:warning: En caso de no tener una imagen de docker, si corremos `docker run --rm <imagen>`, se encargará de descargar la imagen y ejecutarla en cuanto la tenga disponible.

![Docker jjmerelo dalesky](https://github.com/pepitoenpeligro/CC-Ejercicios/blob/master/images/3/01-docker-jjmerelo-dalesky.png)






# Ejercicio 2. Tomar algún programa simple, "Hola mundo" impreso desde el intérprete de línea de órdenes, y comparar el tamaño de las imágenes de diferentes sistemas operativos base, Fedora, CentOS y Alpine, por ejemplo.


Vamos a generar el `Dockerfile` para crear la imagen con _Fedora_:

```shell
FROM fedora:latest

# Establecemos el directorio de trabajo del ejercicio.
WORKDIR /Users/pp/Google\ Drive/mii/1/CC/pruebas/4

RUN dnf install perl -y

# Copiamos el script hipepe a la raiz del contenedor
COPY ./hipepe.pl ./

# El comando a ejecutar es perl junto al script
CMD ["perl", "./hipepe.pl"]
```


```shell
docker build --no-cache -t fedoraperl -f Dockerfile .
```

Y lanzamos el contenedor para que nos salude.

![Docker Fedoraperl](https://github.com/pepitoenpeligro/CC-Ejercicios/blob/master/images/3/02-fedora-perl.png)



Ahora vamos a generar el `Dockerfile` para _centos_, en concreto usando la versión 8 de _centos_.

```shell
FROM centos:centos8

# Establecemos el directorio de trabajo del ejercicio.
WORKDIR /Users/pp/Google\ Drive/mii/1/CC/pruebas/4

RUN yum install perl -y


# Copiamos el script hipepe a la raiz del contenedor
COPY ./hipepe.pl ./

# El comando a ejecutar es perl junto al script
CMD ["perl", "./hipepe.pl"]
```

Y lanzamos el contenedor para que nos salude.

```shell
docker build --no-cache -t centosperl -f Dockerfile .
```

![Docker Centosperl](https://github.com/pepitoenpeligro/CC-Ejercicios/blob/master/images/3/02-centos-perl.png)

Ahora vamos a generar el `Dockerfile` para _alpine_, en concreto usando la última versión estable de _alpine_.


```shell
FROM alpine:latest

# Establecemos el directorio de trabajo del ejercicio.
WORKDIR /Users/pp/Google\ Drive/mii/1/CC/pruebas/4

RUN apk update && apk add perl


# Copiamos el script hipepe a la raiz del contenedor
COPY ./hipepe.pl ./

# El comando a ejecutar es perl junto al script
CMD ["perl", "./hipepe.pl"]
```

Y lanzamos el contenedor para que nos salude.

```shell
docker build --no-cache -t alpineperl -f Dockerfile .
```

![Docker Alpineperl](https://github.com/pepitoenpeligro/CC-Ejercicios/blob/master/images/3/02-alpine-perl.png)


Ahora vamos a comprobar el peso de cada una de las imágenes ejecutando:

```shell
docker images 
```

![Docker images](https://github.com/pepitoenpeligro/CC-Ejercicios/blob/master/images/3/02-docker-images.png)

Podemos observar como la imagen que menos peso tiene es la de __alpine__. Esto se debe principalmente a que el sistema contiene lo básico y necesario para ejecutarse y que pesa entre 4-6 MB, mientras que _fedora_ o _centos_, pesan varios MB más.



# Ejercicio 3. Crear a partir del contenedor anterior una imagen persistente con `commit`.

Primero comenzamos observando los contenedores y sus estados con:

```shell
docker ps -l
```

Y vemos que existe un contenedor con una imagen llamada __alpineperl__ que es justo la última que ejecutamos en el ejercicio anterior (ver ejercicio 2). 

Si nos fijamos, nos indica un `container id`. Ese identificador único, es el que nos sirve para crear la nueva imagen a partir de dicho contenedor.


```shell
docker commit <containerID> <nameNewContainer>
```

Ahora podemos visualizar si efectivamente fue creado con:

```shell
docker image ls
```

Y efectivamente fue creado, pesa exactamente lo mismo que el original (no hubo cambios) y su nombre es justo el indicado.

![Docker commit](https://github.com/pepitoenpeligro/CC-Ejercicios/blob/master/images/3/03-docker-commit.png)







# Ejercicio 4. Examinar la estructura de capas que se forma al crear imágenes nuevas a partir de contenedores que se hayan estado ejecutando.


# Ejercicio 5. Crear un volumen y usarlo, por ejemplo, para escribir la salida de un programa determinado.


# Ejercicio 6. Usar un miniframework REST para crear un servicio web y introducirlo en un contenedor, y componerlo con un cliente REST que sea el que finalmente se ejecuta y sirve como “frontend”.


# Ejercicio 7. Reproducir los contenedores creados anteriormente usando un `Dockerfile`.


# Ejercicio 8. Crear con docker-machine una máquina virtual local que permita desplegar contenedores y ejecutar en él contenedores creados con antelación.


# Referencias
* [Install docker OS X](https://medium.com/crowdbotics/a-complete-one-by-one-guide-to-install-docker-on-your-mac-os-using-homebrew-e818eb4cfc3)
* [Dockerfiles](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)
* [Dockerfile for Centos8 and Raku](https://github.com/nxadm/rakudo-pkg/blob/master/docker/Dockerfile-centos-x86_64-8)